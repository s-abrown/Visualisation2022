<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yankee and the Brave</title>
    <style>
        svg {
            background-color: whitesmoke;
            margin: 1px solid;
        }

        div.tooltip {
            position: absolute;
            text-align: center;
            width: 60px;
            height: 85px;
            padding: 2px;
            font: 12px sans-serif;
            background: #f2b8ec;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            display: inline-block;
        }

    </style>
    <button id= "Elbutton">El-p</button>
    <button id= "KMbutton">Killer Mike</button>
</head>
<body>


<!-- Load d3.js -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<!-- Create a div where the graph will take place -->
<script>
    const width = window.innerWidth;
    const height = window.innerHeight; 

        d3.csv('RTJ4.csv', function (d) {
            return {
                speaker : d.speaker,
                boasting : +d.mentionBoasting,
                killerMike : +d.mentionKillerMike,
                elP : +d.mentionElP,
                family : +d.mentionFamily,
                disillusion : +d.mentionDisillusion,
                threatening : +d.mentionThreatening,
                anguish : +d.mentionAnguish,
                existentialism : +d.mentionExistentialism,
                poverty : +d.mentionPoverty,
                education : +d.mentionEducation,
                wealth : +d.mentionWealth,
                work : +d.mentionWork,
                crime : +d.mentionCrime,
                elections : +d.mentionElections,
                slavery : +d.mentionSlavery,
                racism : +d.mentionRacism,
                revolution : +d.mentionRevolution,
                antiReligion : +d.mentionAntiReligion,
                authority : +d.mentionAuthority,
                antiCapitalism : +d.mentionAntiCapitalism,
                antiPolice : +d.mentionAntiPolice,
                money : +d.mentionMoney,
                car : +d.mentionCar, 
                weapon : +d.mentionWeapon,
                socialMedia : +d.mentionSocialMedia,
                person : +d.mentionKillerMike + +d.mentionElP + +d.mentionFamily + +d.mentionOsamaBL + +d.mentionMohammedAli + +d.mentionKurtVonnegut + +d.mentionAynRand + +d.mentionDonaldTrump + +d.mentionToussainLouverture + +d.mentionNapoleonBonaparte + +d.mentionMalcolmX + +d.mentionMLK + +d.mentionJimmySavile + +d.mentionNoamChomsky + +d.mentionCharlesBukowski + +d.mentionDickGregory,
                feeling : +d.mentionBoasting + +d.mentionDisillusion + +d.mentionThreatening + +d.mentionAnguish + +d.mentionExistentialism,
                place : +d.mentonBrooklyn + +d.mentionNewYork + +d.mentionMiami + +d.mentionAtlanta + +d.mentionGuantanamo,
                state : +d.mentionPoverty + +d.mentionEducation + +d.mentionWealth,
                object : +d.mentionCar + +d.mentionMoney + +d.mentionWeapon + +d.mentionSocialMedia,
                action : +d.mentionWork + +d.mentionCrime,
                substanceUse : +d.mentionDrugs + +d.mentionAlcohol + +d.mentionTobacco,
                trackNumber : +d.trackNumber,
            }
        }).then(data => {
            // Check data:
            // console.log("My complete data set: ", data)

            // Creating the space for the graph with margins
            const margin = {top: 30, right: 30, bottom: 70, left: 60},
                w = 860 - margin.left - margin.right,
                h = 800 - margin.top - margin.bottom;

            // Creating the canvas
            const svg = d3.select("body")
                .append("svg")
                    .attr("width", w + margin.left + margin.right)
                    .attr("height", h + margin.top + margin.bottom)
                .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);
            
            // Looping through the dataset to obtain what we need for the graph:
            let boastingAlbumEl = 0
            let Elmentionpp = 0
            let Elfeelings = 0
            let Elplaces = 0
            let Elsubstances = 0
            let Elstate = 0
            let Elobjs = 0
            let Elcrime = 0
            let Elwork = 0
            let boastingAlbumKM = 0
            let KMmentionpp = 0
            let KMfeelings = 0
            let KMplaces = 0
            let KMsubstances = 0
            let KMstate = 0
            let KMobjs = 0
            let KMcrime = 0
            let KMwork = 0
            let boastingAlbumPW = 0
            let boastingAlbumZDR = 0
            for (let i = 0; i < data.length; i++){
                if (data[i].speaker == 'el-p'){
                boastingAlbumEl += data[i].boasting
                Elmentionpp += data[i].person
                Elfeelings += data[i].feeling
                Elplaces += data[i].place
                Elsubstances += data[i].substanceUse
                Elstate += data[i].state
                Elobjs += data[i].object
                Elcrime += data[i].crime
                Elwork += data[i].work
                }
                if (data[i].speaker == 'killerMike'){
                boastingAlbumKM += data[i].boasting
                KMmentionpp += data[i].person
                KMfeelings += data[i].feeling
                KMplaces += data[i].place
                KMsubstances += data[i].substanceUse
                KMstate += data[i].state
                KMobjs += data[i].object
                KMcrime += data[i].crime
                KMwork += data[i].work
                }
            }

            // Datasets for the graph
            // For El-P
            const El = [
                {group: "boasting", value: boastingAlbumEl},
                {group: "people", value: Elmentionpp},
                {group: "feelings", value: Elfeelings},
                {group: "places", value: Elplaces},
                {group: "substance use", value: Elsubstances},
                {group: "state of being", value: Elstate},
                {group: "objects", value: Elobjs},
                {group: "crime", value: Elcrime},
                {group: "work", value: Elwork}
            ]
            
            // For KM
            const KM = [
                {group: "boasting", value: boastingAlbumKM}, 
                {group: "people", value: KMmentionpp},
                {group: "feelings", value: KMfeelings},
                {group: "places", value: KMplaces},
                {group: "substance use", value: KMsubstances},
                {group: "state of being", value: KMstate},
                {group: "objects", value: KMobjs},
                {group: "crime", value: KMcrime},
                {group: "work", value: KMwork}
            ]

            // Checking data:
            // console.log(El)
            // console.log(KM)


            // Adding X axis
            const x = d3.scaleBand()
                .range([0, w])
                .domain(El.map(d => d.group))
                .padding(0.2);
            svg.append("g")
                .attr("transform", `translate(0,${h})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end")
                    .style("font-size", 15)
                    .style("color", "purple")
            
            // Add Y axis
            const y = d3.scaleLinear()
                .domain([0, 160])
                .range([ h, 0]);
            svg.append("g")
                .attr("class", "myYaxis")
                .call(d3.axisLeft(y));
            
            // Adding event listeners for each button
            // For El-P's button
            document.getElementById('Elbutton')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    return El
                })
            // For KM's button
            document.getElementById('KMbutton')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    return KM
            })

            // Making a tooltip
            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Creating the rectangles for the bar chart
            function updateData(data){
                let update = svg.selectAll('rect')
                    .data(data)
                    .join('rect')
                    .transition()
                    .ease(d3.easeBounce)
                    .duration(1500)
                    .attr("x", d => x(d.group))
                    .attr("y", d => y(d.value))
                    .attr("width", x.bandwidth())
                    .attr("height", d => h - y(d.value))
                    .attr("fill", "#e81ce8")
            }

            // Initialize the plot with the first dataset:
            updateData(El)

            let name = "El-p"

            // For El-P's button
            document.getElementById('Elbutton')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    updateData(El)
                    name = "El-p"
                })
            
            // For KM's button
            document.getElementById('KMbutton')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    updateData(KM)
                    name = "Killer Mike"
            })

            // Adding the mouseover event to each rectangle to display the tooltip and display the value of each bar:
            svg.selectAll("rect")
            .on("mouseover", function(event,d) {
                            div.transition()
                                .duration(200)
                                .style("opacity", .9)
                                .style("border", "solid 2px")
                            div.html(`${name} has mentioned ${d.group} <br/> ${d.value} times throughout the album`)
                                .style("left", (event.pageX) + "px")
                                .style("top", (event.pageY - 28) + "px");
                            })
                            .on("mouseout", function(d) {
                            div.transition()
                                .duration(500)
                                .style("opacity", 0)
                            });

        })
</script>
</body>
</html>