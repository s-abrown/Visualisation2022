<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Album Simple Bar Chart</title>
    <style>
        svg {
            background-color: whitesmoke;
            margin: 1px solid;
        }

        div.tooltip {
            position: absolute;
            text-align: center;
            width: 60px;
            height: 85px;
            padding: 2px;
            font: 12px sans-serif;
            background: #f2b8ec;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            display: inline-block;
        }

        button {
            border-radius:10px;
            background-color:#e81ce8;
            color: white;
        }

    </style>
</head>
<body>
    <button id= "Elbutton">El-p</button>
    <button id= "KMbutton">Killer Mike</button>

    <div id="my_pie"></div>
    <div id="resultElp"></div>
    </br>
    <div id="resultKM"></div>

    <!-- Create a div where the graph will take place -->
    <div class="pieOptions">
        <div> Choose parameters: </div>
        </br>
        <div id="feelings">Feelings</div>
        <div id="boasting">Boasting</div>
        <div id="substanceUse">Substance use</div>
        <div id="people">People</div>
        <div id="place">Place</div>
        <div id="state">State</div>
        <div id="object">Object</div>
        <div id="action">Action</div>
    </div>

    <button id="btnElp">El-p</button>
    <button id="btnKM">Killer Mike</button>


<!-- Load d3.js -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<!-- Create a div where the graph will take place -->
<script>
    const width = window.innerWidth;
    const height = window.innerHeight; 

        d3.csv('RTJ4.csv', function (d) {
            return {
                // subcategories
                // speaker
                speaker : d.speaker,
                // 1. people mentioned
                killerMike : +d.mentionKillerMike,
                elP : +d.mentionElP,
                family : +d.mentionFamily,
                OsamaBenLaden : +d.mentionOsamaBL,
                MohammedAli : +d.mentionMohammedAli,
                KurtVonnegut : +d.mentionKurtVonnegut,
                AynRand : +d.mentionAynRand,
                DonaldTrump : +d.mentionDonaldTrump,
                ToussainLouverture : +d.mentionToussainLouverture,
                NapoleonBonaparte : +d.mentionNapoleonBonaparte,
                MalcolmX : +d.mentionMalcolmX,
                MartinLuterKing : +d.mentionMLK,
                JimmySaville : +d.mentionJimmySavile,
                NoamChomsky : +d.mentionNoamChomsky,
                CharlesBukowski : +d.mentionCharlesBukowski,
                DickGregory : +d.mentionDickGregory,
                // 2. feelings
                boasting : +d.mentionBoasting,
                disillusion : +d.mentionDisillusion,
                threatening : +d.mentionThreatening,
                anguish : +d.mentionAnguish,
                existentialism : +d.mentionExistentialism,
                // 3. place
                brooklyn: +d.mentonBrooklyn,
                newYork: +d.mentionNewYork,
                miami: +d.mentionMiami,
                atlanta: +d.mentionAtlanta,
                guantanamo: +d.mentionGuantanamo,
                // 4. substance use
                drugs: +d.mentionDrugs,
                alcohol: +d.mentionAlcohol,
                tobacco: +d.mentionTobacco,
                // 5. state of being
                poverty : +d.mentionPoverty,
                education : +d.mentionEducation,
                wealth : +d.mentionWealth,
                // 6. objects
                car : +d.mentionCar, 
                money: d.mentionMoney,
                weapon : +d.mentionWeapon,
                socialMedia : +d.mentionSocialMedia, 
                // 7. actions
                work : +d.mentionWork,
                crime : +d.mentionCrime,
                // 8. politics
                antiCapitalism : +d.mentionAntiCapitalism,
                antiPolice : +d.mentionAntiPolice,
                authority : +d.mentionAuthority,
                slavery : +d.mentionSlavery,
                racism : +d.mentionRacism,
                elections : +d.mentionElections,
                revolution : +d.mentionRevolution,
                antiReligion : +d.mentionAntiReligion,
                
                // main categories
                person : +d.mentionKillerMike + +d.mentionElP + +d.mentionFamily + +d.mentionOsamaBL + +d.mentionMohammedAli + +d.mentionKurtVonnegut + +d.mentionAynRand + +d.mentionDonaldTrump + +d.mentionToussainLouverture + +d.mentionNapoleonBonaparte + +d.mentionMalcolmX + +d.mentionMLK + +d.mentionJimmySavile + +d.mentionNoamChomsky + +d.mentionCharlesBukowski + +d.mentionDickGregory,
                feelings : +d.mentionBoasting + +d.mentionDisillusion + +d.mentionThreatening + +d.mentionAnguish + +d.mentionExistentialism,
                place : +d.mentonBrooklyn + +d.mentionNewYork + +d.mentionMiami + +d.mentionAtlanta + +d.mentionGuantanamo,
                substanceUse : +d.mentionDrugs + +d.mentionAlcohol + +d.mentionTobacco,
                state : +d.mentionPoverty + +d.mentionEducation + +d.mentionWealth,
                object : +d.mentionCar + +d.mentionMoney + +d.mentionWeapon + +d.mentionSocialMedia,
                action : +d.mentionWork + +d.mentionCrime,
                politics : +d.mentionAntiCapitalism + +d.mentionAntiPolice + +d.mentionAuthority + +d.mentionSlavery + +d.mentionRacism + +d.mentionElections + +d.mentionRevolution + +d.mentionAntiReligion,
                // track number
                trackNumber : +d.trackNumber,
            }
            }).then(data => {
            // Check data:
            console.log("My complete data set, all speakers included : ", data)

            // Creating the space for the graph with margins
            const margin = {top: 30, right: 30, bottom: 100, left: 60},
                w = 500 - margin.left - margin.right,
                h = 500 - margin.top - margin.bottom;

            // Creating the canvas
            const canvas1 = d3.select("body")
                .append("svg")
                    .attr("width", w + margin.left + margin.right)
                    .attr("height", h + margin.top + margin.bottom)
                .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);
            
            // Looping through the dataset to obtain what we need for the graphs while splitting both speakers: 
            // I. For El-P: 
            // main categories (8 total)
            let Elmentionpp = 0
            let Elfeelings = 0
            let Elplaces = 0
            let Elsubstances = 0
            let Elstate = 0
            let Elobjs = 0
            let Elaction = 0
            let Elpolitics = 0
            // subcategories
            // 1. people (16 total)
            let ElkillerMike = 0
            let ElelP = 0
            let Elfamily = 0
            let ElOsamaBenLaden = 0
            let ElMohammedAli = 0
            let ElKurtVonnegut = 0
            let ElAynRand = 0
            let ElDonaldTrump = 0
            let ElToussainLouverture = 0
            let ElNapoleonBonaparte = 0
            let ElMalcolmX = 0
            let ElMartinLuterKing = 0
            let ElJimmySaville = 0
            let ElNoamChomsky = 0
            let ElCharlesBukowski = 0
            let ElDickGregory = 0
            // 2. feelings (5 total)
            let boastingAlbumEl = 0
            // Is this better for cohesiveness' sake? --> let Elboasting = 0
            let Eldisillusion = 0
            let Elthreatening = 0
            let Elanguish = 0
            let Elexistentialism = 0
            // 3. places (5 total)
            let Elbrooklyn = 0
            let ElnewYork = 0
            let Elmiami = 0
            let Elatlanta = 0
            let Elguantanamo = 0
            // 4. substance use (3 total)
            let Eldrugs = 0
            let Elalcohol = 0
            let Eltobacco = 0
            // 5. state of being (3 total)
            let Elpoverty = 0
            let Eleducation = 0
            let Elwealth = 0
            // 6. objects (4 total)
            let Elcar = 0
            let Elmoney = 0
            let Elweapon = 0
            let ElsocialMedia = 0
            // 7. action (2 total)
            let Elwork = 0
            let Elcrime = 0
            // 8. politics (8 total)
            let ElantiCapitalism = 0
            let ElantiPolice = 0
            let Elauthority = 0
            let Elslavery = 0
            let Elracism = 0
            let Elelections = 0
            let Elrevolution = 0
            let ElantiReligion = 0


            // II. For Killer Mike: 
            // main categories (8 total)
            let KMmentionpp = 0
            let KMfeelings = 0
            let KMplaces = 0
            let KMsubstances = 0
            let KMstate = 0
            let KMobjs = 0
            let KMaction = 0
            let KMpolitics = 0
            // subcategories
            // 1. people (16 total)
            let KMkillerMike = 0
            let KMelP = 0
            let KMfamily = 0
            let KMOsamaBenLaden = 0
            let KMMohammedAli = 0
            let KMKurtVonnegut = 0
            let KMAynRand = 0
            let KMDonaldTrump = 0
            let KMToussainLouverture = 0
            let KMNapoleonBonaparte = 0
            let KMMalcolmX = 0
            let KMMartinLuterKing = 0
            let KMJimmySaville = 0
            let KMNoamChomsky = 0
            let KMCharlesBukowski = 0
            let KMDickGregory = 0
            // 2. feelings (5 total)
            let boastingAlbumKM = 0
            // Is this better for cohesiveness' sake? --> let KMboasting = 0
            let KMdisillusion = 0
            let KMthreatening = 0
            let KManguish = 0
            let KMexistentialism = 0
            // 3. places (5 total)
            let KMbrooklyn = 0
            let KMnewYork = 0
            let KMmiami = 0
            let KMatlanta = 0
            let KMguantanamo = 0
            // 4. substance use (3 total)
            let KMdrugs = 0
            let KMalcohol = 0
            let KMtobacco = 0
            // 5. state of being (3 total)
            let KMpoverty = 0
            let KMeducation = 0
            let KMwealth = 0
            // 6. objects (4 total)
            let KMcar = 0
            let KMmoney = 0
            let KMweapon = 0
            let KMsocialMedia = 0
            //7. action (2 total)
            let KMwork = 0
            let KMcrime = 0
            // 8. politics (8 total)
            let KMantiCapitalism = 0
            let KMantiPolice = 0
            let KMauthority = 0
            let KMslavery = 0
            let KMracism = 0
            let KMelections = 0
            let KMrevolution = 0
            let KMantiReligion = 0

            // adding the data: 
            for (let i = 0; i < data.length; i++){
                // I. For El-P
                if (data[i].speaker == 'el-p'){
                    // main categories (8)
                    Elmentionpp += data[i].person
                    Elfeelings += data[i].feelings
                    Elplaces += data[i].place
                    Elsubstances += data[i].substanceUse
                    Elstate += data[i].state
                    Elobjs += data[i].object
                    Elaction += data[i].action
                    Elpolitics += data[i].politics
                    // subcategories
                    // 1. people
                    ElkillerMike += data[i].killerMike
                    ElelP += data[i].elP
                    Elfamily += data[i].family
                    ElOsamaBenLaden += data[i].OsamaBenLaden
                    ElMohammedAli += data[i].MohammedAli
                    ElKurtVonnegut += data[i].KurtVonnegut
                    ElAynRand += data[i].AynRand
                    ElDonaldTrump += data[i].DonaldTrump
                    ElToussainLouverture += data[i].ToussainLouverture
                    ElNapoleonBonaparte += data[i].NapoleonBonaparte
                    ElMalcolmX += data[i].MalcolmX
                    ElMartinLuterKing += data[i].MartinLuterKing
                    ElJimmySaville += data[i].JimmySaville
                    ElNoamChomsky += data[i].NoamChomsky
                    ElCharlesBukowski += data[i].CharlesBukowski
                    ElDickGregory += data[i].DickGregory
                    // 2. feelings (5)
                    boastingAlbumEl += data[i].boasting
                    // Is this better for cohesiveness' sake? --> let Elboasting = 0
                    Eldisillusion += data[i].disillusion
                    Elthreatening += data[i].threatening
                    Elanguish += data[i].anguish
                    Elexistentialism += data[i].existentialism
                    // 3. places (5)
                    Elbrooklyn += data[i].brooklyn
                    ElnewYork += data[i].newYork
                    Elmiami += data[i].miami
                    Elatlanta += data[i].atlanta
                    Elguantanamo += data[i].guantanamo
                    // 4. substance use (3)
                    Eldrugs += data[i].drugs
                    Elalcohol += data[i].alcohol
                    Eltobacco += data[i].tobacco
                    // 5. state of being (3)
                    Elpoverty += data[i].poverty
                    Eleducation += data[i].education
                    Elwealth += data[i].wealth
                    // 6. objects (4)
                    Elcar += data[i].car
                    Elmoney += data[i].money
                    Elweapon += data[i].weapon
                    ElsocialMedia += data[i].socialMedia
                    // 7. action (2)
                    Elwork += data[i].work
                    Elcrime += data[i].crime
                    // 8. politics (8)
                    ElantiCapitalism += data[i].antiCapitalism
                    ElantiPolice += data[i].antiPolice
                    Elauthority += data[i].authority
                    Elslavery += data[i].slavery
                    Elracism += data[i].racism
                    Elelections += data[i].elections
                    Elrevolution += data[i].revolution
                    ElantiReligion += data[i].antiReligion
                }

                // II. For Killer Mike
                if (data[i].speaker == 'killerMike'){
                    // main categories (8)
                    KMmentionpp += data[i].person
                    KMfeelings += data[i].feelings
                    KMplaces += data[i].place
                    KMsubstances += data[i].substanceUse
                    KMstate += data[i].state
                    KMobjs += data[i].object
                    KMaction += data[i].action
                    KMpolitics += data[i].politics
                    // subcategories
                    // 1. people
                    KMkillerMike += data[i].killerMike
                    KMelP += data[i].elP
                    KMfamily += data[i].family
                    KMOsamaBenLaden += data[i].OsamaBenLaden
                    KMMohammedAli += data[i].MohammedAli
                    KMKurtVonnegut += data[i].KurtVonnegut
                    KMAynRand += data[i].AynRand
                    KMDonaldTrump += data[i].DonaldTrump
                    KMToussainLouverture += data[i].ToussainLouverture
                    KMNapoleonBonaparte += data[i].NapoleonBonaparte
                    KMMalcolmX += data[i].MalcolmX
                    KMMartinLuterKing += data[i].martinLutherKing
                    KMJimmySaville += data[i].JimmySaville
                    KMNoamChomsky += data[i].NoamChomsky
                    KMCharlesBukowski += data[i].CharlesBukowski
                    KMDickGregory += data[i].DickGregory
                    // 2. feelings (5)
                    boastingAlbumKM += data[i].boasting
                    // Is this better for cohesiveness' sake? --> let KMboasting = 0
                    KMdisillusion += data[i].disillusion
                    KMthreatening += data[i].threatening
                    KManguish += data[i].anguish
                    KMexistentialism += data[i].existentialism
                    // 3. places (5)
                    KMbrooklyn += data[i].brooklyn
                    KMnewYork += data[i].newYork
                    KMmiami += data[i].miami
                    KMatlanta += data[i].atlanta
                    KMguantanamo += data[i].guantanamo
                    // 4. substance use (3)
                    KMdrugs += data[i].drugs
                    KMalcohol += data[i].alcohol
                    KMtobacco += data[i].tobacco
                    // 5. state of being (3)
                    KMpoverty += data[i].poverty
                    KMeducation += data[i].education
                    KMwealth += data[i].wealth
                    // 6. objects (4)
                    KMcar += data[i].car
                    KMmoney += data[i].money
                    KMweapon += data[i].weapon
                    KMsocialMedia += data[i].socialMedia
                    // 7. action (2)
                    KMwork += data[i].work
                    KMcrime += data[i].crime
                    // 8. politics (8)
                    KMantiCapitalism += data[i].antiCapitalism
                    KMantiPolice += data[i].antiPolice
                    KMauthority += data[i].authority
                    KMslavery += data[i].slavery
                    KMracism += data[i].racism
                    KMelections += data[i].elections
                    KMrevolution += data[i].revolution
                    KMantiReligion += data[i].antiReligion
                }
            }


            // Datasets for the graph
            // I. For El-P
            const El = [
                // categories
                {group: "people", value: Elmentionpp},
                {group: "feelings", value: Elfeelings},
                {group: "places", value: Elplaces},
                {group: "substance use", value: Elsubstances},
                {group: "state of being", value: Elstate},
                {group: "objects", value: Elobjs},
                {group: "actions", value: Elaction},
                {group: "politics", value: Elpolitics},
                //subcategories
                // 1. people
                {group: "killerMike", value: ElkillerMike},
                {group: "elP", value: ElelP},
                {group: "family", value: Elfamily},
                {group: "OsamaBenLaden", value: ElOsamaBenLaden},
                {group: "MohammedAli", value: ElMohammedAli},
                {group: "KurtVonnegut", value: ElKurtVonnegut},
                {group: "AynRand", value: ElAynRand},
                {group: "DonaldTrump", value: ElDonaldTrump},
                {group: "ToussainLouverture", value: ElToussainLouverture},
                {group: "NapoleonBonaparte", value: ElNapoleonBonaparte},
                {group: "MalcolmX", value: ElMalcolmX},
                {group: "martinLutherKing", value: ElMartinLuterKing},
                {group: "JimmySaville", value: ElJimmySaville},
                {group: "NoamChomsky", value: ElNoamChomsky},
                {group: "CharlesBukowski", value: ElCharlesBukowski},
                {group: "DickGregory", value: ElDickGregory},
                // 2. feelings
                {group: "boasting", value: boastingAlbumEl},
                {group: "disillusion", value: Eldisillusion},
                {group: "threatening", value: Elthreatening},
                {group: "anguish", value: Elanguish},
                {group: "existentialism", value: Elexistentialism},
                // 3. places
                {group: "brooklyn", value: Elbrooklyn},
                {group: "newYork", value: ElnewYork},
                {group: "miami", value: Elmiami},
                {group: "atlanta", value: Elatlanta},
                {group: "guantanamo", value: Elguantanamo},
                // 4. substance use
                {group: "drugs", value: Eldrugs},
                {group: "alcohol", value: Elalcohol},
                {group: "tobacco", value: Eltobacco},
                // 5. state of being
                {group: "poverty", value: Elpoverty},
                {group: "education", value: Eleducation},
                {group: "wealth", value: Elwealth},
                // 6. object
                {group: "car", value: Elcar},
                {group: "money", value: Elmoney},
                {group: "weapon", value: Elweapon},
                {group: "socialMedia", value: ElsocialMedia},
                // 7. action
                {group: "work", value: Elwork},
                {group: "crime", value: Elcrime},
                // 8. politics
                {group: "antiCapitalism", value: ElantiCapitalism},
                {group: "antiPolice", value: ElantiPolice},
                {group: "authority", value: Elauthority},
                {group: "slavery", value: Elslavery},
                {group: "racism", value: Elracism},
                {group: "elections", value: Elelections},
                {group: "revolution", value: Elrevolution},
                {group: "antiReligion", value: ElantiReligion},
            ]
            // Check
            console.log("total main category data for EL-P : ", El)
            console.log("Why is the value for money for EL-P so high? O_O ", Elmoney)
            
            // II. For KM
            const KM = [
                // main categories
                {group: "people", value: KMmentionpp},
                {group: "feelings", value: KMfeelings},
                {group: "places", value: KMplaces},
                {group: "substance use", value: KMsubstances},
                {group: "state of being", value: KMstate},
                {group: "objects", value: KMobjs},
                {group: "actions", value: KMaction},
                {group: "politics", value: Elpolitics},
                // subcategories
                // 1. people
                {group: "killerMike", value: KMkillerMike},
                {group: "elP", value: KMelP},
                {group: "family", value: KMfamily},
                {group: "OsamaBenLaden", value: KMOsamaBenLaden},
                {group: "MohammedAli", value: KMMohammedAli},
                {group: "KurtVonnegut", value: KMKurtVonnegut},
                {group: "AynRand", value: KMAynRand},
                {group: "DonaldTrump", value: KMDonaldTrump},
                {group: "ToussainLouverture", value: KMToussainLouverture},
                {group: "NapoleonBonaparte", value: KMNapoleonBonaparte},
                {group: "MalcolmX", value: KMMalcolmX},
                {group: "martinLutherKing", value: KMMartinLuterKing},
                {group: "JimmySaville", value: KMJimmySaville},
                {group: "NoamChomsky", value: KMNoamChomsky},
                {group: "CharlesBukowski", value: KMCharlesBukowski},
                {group: "DickGregory", value: KMDickGregory},
                // 2. feelings
                {group: "boasting", value: boastingAlbumKM},
                {group: "disillusion", value: KMdisillusion},
                {group: "threatening", value: KMthreatening},
                {group: "anguish", value: KManguish},
                {group: "existentialism", value: KMexistentialism},
                // 3. places
                {group: "brooklyn", value: KMbrooklyn},
                {group: "newYork", value: KMnewYork},
                {group: "miami", value: KMmiami},
                {group: "atlanta", value: KMatlanta},
                {group: "guantanamo", value: KMguantanamo},
                // 4. substance use
                {group: "drugs", value: KMdrugs},
                {group: "alcohol", value: KMalcohol},
                {group: "tobacco", value: KMtobacco},
                // 5. state of being
                {group: "poverty", value: KMpoverty},
                {group: "education", value: KMeducation},
                {group: "wealth", value: KMwealth},
                // 6. object
                {group: "car", value: KMcar},
                {group: "money", value: KMmoney},
                {group: "weapon", value: KMweapon},
                {group: "socialMedia", value: KMsocialMedia},
                // 7. action
                {group: "work", value: KMwork},
                {group: "crime", value: KMcrime},
                // 8. politics
                {group: "antiCapitalism", value: KMantiCapitalism},
                {group: "antiPolice", value: KMantiPolice},
                {group: "authority", value: KMauthority},
                {group: "slavery", value: KMslavery},
                {group: "racism", value: KMracism},
                {group: "elections", value: KMelections},
                {group: "revolution", value: KMrevolution},
                {group: "antiReligion", value: KMantiReligion},
            ]
            // Check
            console.log("total main category data for Killer Mike : ", KM)


            // Adding X axis
            const x = d3.scaleBand()
                .range([0, w])
                .domain(El.map(d => d.group))
                .padding(0.2);
            canvas1.append("g")
                .attr("transform", `translate(0,${h})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end")
                    .style("font-size", 15)
                    .style("color", "purple")
            
            // Add Y axis
            const y = d3.scaleLinear()
                .domain([0, 160])
                .range([ h, 0]);
            canvas1.append("g")
                .attr("class", "myYaxis")
                .call(d3.axisLeft(y));
            
            // Adding event listeners for each button
            // For El-P's button
            document.getElementById('Elbutton')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    return El
                })
            // For KM's button
            document.getElementById('KMbutton')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    return KM
            })

            // Making a tooltip
            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Creating the rectangles for the bar chart
            function updateData(data){
                let updateBar = canvas1.selectAll('rect')
                    .data(data)
                    .join('rect')
                    .transition()
                    .ease(d3.easeBounce)
                    .duration(1500)
                    .attr("x", d => x(d.group))
                    .attr("y", d => y(d.value))
                    .attr("width", x.bandwidth())
                    .attr("height", d => h - y(d.value))
                    .attr("fill", "#e81ce8")
                // let update circle1... 
                // etc    
            }

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


            // Initialize the plot with the first dataset:
            updateData(El)

            let name = "El-p"

            // For El-P's button
            document.getElementById('Elbutton')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    updateData(El)
                    name = "El-p"
                })
            
            // For KM's button
            document.getElementById('KMbutton')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    updateData(KM)
                    name = "Killer Mike"
            })

            // Adding the mouseover event to each rectangle to display the tooltip and display the value of each bar:
            canvas1.selectAll("rect")
            .on("mouseover", function(event,d) {
                            div.transition()
                                .duration(200)
                                .style("opacity", .9)
                                .style("border", "solid 2px")
                            div.html(`${name} has mentioned ${d.group} <br/> ${d.value} times throughout the album`)
                                .style("left", (event.pageX) + "px")
                                .style("top", (event.pageY - 28) + "px");
                            })
                            .on("mouseout", function(d) {
                            div.transition()
                                .duration(500)
                                .style("opacity", 0)
                            });
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// CIRCLES 
                            
            
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//PIE CHART  
            
            const canvas2 = d3.select("body")
                .append("svg")
                    .attr("width", window.innerWidth + margin.left + margin.right)
                    .attr("height", h + margin.top + margin.bottom) // output: NaN?????
                .append("g")

            // set the dimensions and margins of the graph
            const piewidth = 450, pieheight = 450, piemargin = 40;
            const radius = Math.min(piewidth, pieheight) / 2 - piemargin;

            let valueEl = boastingAlbumEl
            let valueKM = boastingAlbumKM

            let dataset = {El:valueEl, KM:valueKM}
            let topic = "boasting"

            document.getElementById('people')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    valueEl = Elmentionpp
                    valueKM = KMmentionpp
                    dataset = {El:valueEl, KM:valueKM}
                    console.log(dataset)
                    topic = "people"
                    update(dataset)
                })

            document.getElementById('feelings')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elfeelings
                valueKM = KMfeelings
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "feelings"
                update(dataset)
            })

            document.getElementById('boasting')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = boastingAlbumEl
                valueKM = boastingAlbumKM
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "boasting"
                update(dataset)
            })

            document.getElementById('substanceUse')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elsubstances
                valueKM = KMsubstances
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "substance use"
                update(dataset)
            })

            document.getElementById('place')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elplaces
                valueKM = KMplaces
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "places"
                update(dataset)
            })

            document.getElementById('state')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elstate
                valueKM = KMstate
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "states of being"
                update(dataset)
            })

            document.getElementById('object')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elobjs
                valueKM = KMobjs
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "objects"
                update(dataset)
            })

            document.getElementById('action')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elcrime + Elwork
                valueKM = KMcrime + KMwork
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "actions"
                update(dataset)
            })
            console.log("testing dataset.El", dataset.El)

            // A function that create / update the plot for a given variable:
            function update(data) {

            // Compute the position of each group on the pie:
            const pie = d3.pie()
            .value(function(d) {return d[1]; })
            .sort(function(a, b) { return d3.ascending(a.key, b.key);} ) // This make sure that group order remains the same in the pie chart
            const data_ready = pie(Object.entries(data))

            // map to data
            const u = canvas2.selectAll("path")
            .data(data_ready)

            // Building the pie chart: 
            u
            .join('path')
            // The transition does not always work proprely. We tried to look for solutions online but nothing worked for our project. We undesrtand it is a problem of d3 calculating the position of the arc while transitioning, and that using attrTween would help. As of right now we can't get it to work.
            .transition()
            .duration(1000)
            .attr('d', d3.arc()
                .innerRadius(0)
                .outerRadius(radius)
            )
            .attr('fill', function(d){
                if(d.data[0] == "El"){
                    return "hotpink"
                }
                else if (d.data[0] == "KM"){
                    return "purple"
                }
             })
            .attr("stroke", "white")
            .style("stroke-width", "2px")
            .style("opacity", 1)

            let ElDiv = document.getElementById("resultElp")
            ElDiv.innerHTML = `El-p has mentioned ${topic} ${dataset.El} time(s)`
            let KMDiv = document.getElementById("resultKM")
            KMDiv.innerHTML = `Killer Mike has mentioned ${topic} ${dataset.KM} time(s)`
        }


            // Initialize the plot with the first dataset
            update(dataset)

        
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Heatmap 
    let canvas3 = d3.select('body')
                .append('svg')
                //.attr('width', width - 40)
                .attr("width", width + margin.left + margin.right)
                //.attr('height', height - 40)
                .attr("height", height + margin.top + margin.bottom)
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

          // LABELS FOR THE X AND Y AXES
          let myGroups = ["1. Yankee and the Brave (Ep. 4)", "2. Ooh La La", "3. Out of Sight", "4. Holy Calamafuck", "5. Goonies vs. E.T.", "6. Walking in the Snow", "7. Ju$t", "8. Never Look Back", "9. The Ground Below", "10. Pulling the Pin", "11. A Few Words for the Firing Squad (Radiation)"]
          let myVars = ["Killer Mike", "El-P", "family", "boasting", "disillusion", "threatening", "anguish", "existentialism", "anti-capitalism", "anti-police", "authority", "slavery", "racism", "elections", "revolution", "anti-religion", "poverty", "education", "wealth", "car", "money", "weapon", "social-media ", "work", "crime", "substances"]

            // X AXIS AND SCALE
            let xScale = d3.scaleLinear()
               .domain([1, 25])
               .range([115, 884])
            
            let xAxisGenerator = d3.axisBottom(xScale);
            xAxisGenerator.ticks(25)
            xAxisGenerator.tickFormat((d,i) => myVars[i]);

            let xAxis = canvas3.append("g")
            .call(xAxisGenerator)
            .attr("transform", 'translate(0, 390)')
            .selectAll("text")
              .attr("transform", "translate(-10,2)rotate(-45)")
              .style("text-anchor", "end")
              .style("font-size", 15)
              .style("fill", "#6f00de")

            // Y AXIS AND SCALE
            let yScale = d3.scaleLinear()
               .domain([1, 11])
               .range([50, 370])
            
            let yAxisGenerator = d3.axisLeft(yScale);
            yAxisGenerator.ticks(11)
            yAxisGenerator.tickFormat((d,i) => myGroups[i]);

            let yAxis = canvas3.append("g")
            .call(yAxisGenerator)
            .attr("transform", 'translate(90, 0)')
            .selectAll("text")
              .style("font-size", 15)
              .style("fill", "#6f00de")

          // COLOUR SCALE FOR THE SQUARES
          let myColour = d3.scaleLinear()
            .range(["#ffdef3", "#6f00de"])
            .domain([0, 24])

          // Making a tooltip (refer to the html for more info on the styling)
          let myDiv = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);
        
          // ADDING THE SQUARES
          for(let i=0 ; i< 25 ; i++){
            canvas3.selectAll()
              .data(data.filter(function(d){
                return d.speaker == "el-p" }))
              .enter()
              .append("rect")
                .attr("x", 100 + (i * 32))
                .attr("y", d => d.trackNumber * (32))
                .attr("width", 30)
                .attr("height", 30)
                .style("fill", d => {
                  // mention Killer Mike
                  if(i == 0){
                     return myColour(+d.killerMike)
                  }
                  // mention El-P
                  else if (i == 1){
                    return myColour(+d.elP)
                  }
                  // mention Family
                  else if (i == 2){
                    return myColour(+d.family)
                  }
                  // mention boasting
                  else if (i == 3){
                    return myColour(+d.boasting)
                  }
                  // mention disillusion
                  else if (i == 4){
                    return myColour(+d.disillusion)
                  }
                  // mention threatening
                  else if (i == 5){
                    return myColour(+d.threatening)
                  }
                  // mention anguish
                  else if (i == 6){
                    return myColour(+d.anguish)
                  }
                  // mention existentialism
                  else if (i == 7){
                    return myColour(+d.existentialism)
                  }
                  // mention anti-capitalism
                  else if (i == 8){
                    return myColour(+d.antiCapitalism)
                  }
                  // mention anti-police
                  else if (i == 9){
                    return myColour(+d.antiPolice)
                  }
                  // mention authority
                  else if (i == 10){
                    return myColour(+d.authority)
                  }
                  // mention slavery
                  else if (i == 11){
                    return myColour(+d.slavery)
                  }
                  // mention racism
                  else if (i == 12){
                    return myColour(+d.racism)
                  }
                  // mention elections
                  else if (i == 13){
                    return myColour(+d.elections)
                  }
                  // mention revolution
                  else if (i == 14){
                    return myColour(+d.revolution)
                  }
                  // mention anti-religion
                  else if (i == 15){
                    return myColour(+d.antiReligion)
                  }
                  // mention poverty
                  else if (i == 16){
                    return myColour(+d.poverty)
                  }
                  // mention education
                  else if (i == 17){
                    return myColour(+d.education)
                  }
                  // mention wealth
                  else if (i == 18){
                    return myColour(+d.wealth)
                  }
                  // mention car
                  else if (i == 19){
                    return myColour(+d.car)
                  }
                  // mention money
                  else if (i == 20){
                    return myColour(+d.money)
                  }
                  // mention weapon
                  else if (i == 21){
                    return myColour(+d.weapon)
                  }
                  // mention social-media 
                  else if (i == 22){
                    return myColour(+d.socialMedia)
                  }
                  // mention work
                  else if (i == 23){
                    return myColour(+d.work)
                  }
                  // mention crime
                  else if (i == 24){
                    return myColour(+d.crime)
                  }
                  // mention substances
                  else if (i == 25){
                    return myColour(+d.substanceUse)
                  }
                })
                // Making the tooltip available after clicking the buttons
                tooltip()
              }

            document.getElementById('btnElp')
              .addEventListener('click', function(e){
              e.preventDefault();
              canvas3.selectAll("rect").remove()
              for(let i=0 ; i< 25 ; i++){
                canvas3.selectAll()
                  .data(data.filter(function(d){
                    return d.speaker == "el-p" }))
                  .enter()
                  .append("rect")
                    .attr("x", 100 + (i * 32))
                    .attr("y", d => d.trackNumber * (32))
                    .attr("width", 30)
                    .attr("height", 30)
                    .style("fill", d => {
                      // mention Killer Mike
                      if(i == 0){
                        return myColour(+d.killerMike)
                      }
                      // mention El-P
                      else if (i == 1){
                        return myColour(+d.elP)
                      }
                      // mention Family
                      else if (i == 2){
                        return myColour(+d.family)
                      }
                      // mention boasting
                      else if (i == 3){
                        return myColour(+d.boasting)
                      }
                      // mention disillusion
                      else if (i == 4){
                        return myColour(+d.disillusion)
                      }
                      // mention threatening
                      else if (i == 5){
                        return myColour(+d.threatening)
                      }
                      // mention anguish
                      else if (i == 6){
                        return myColour(+d.anguish)
                      }
                      // mention existentialism
                      else if (i == 7){
                        return myColour(+d.existentialism)
                      }
                      // mention anti-capitalism
                      else if (i == 8){
                        return myColour(+d.antiCapitalism)
                      }
                      // mention anti-police
                      else if (i == 9){
                        return myColour(+d.antiPolice)
                      }
                      // mention authority
                      else if (i == 10){
                        return myColour(+d.authority)
                      }
                      // mention slavery
                      else if (i == 11){
                        return myColour(+d.slavery)
                      }
                      // mention racism
                      else if (i == 12){
                        return myColour(+d.racism)
                      }
                      // mention elections
                      else if (i == 13){
                        return myColour(+d.elections)
                      }
                      // mention revolution
                      else if (i == 14){
                        return myColour(+d.revolution)
                      }
                      // mention anti-religion
                      else if (i == 15){
                        return myColour(+d.antiReligion)
                      }
                      // mention poverty
                      else if (i == 16){
                        return myColour(+d.poverty)
                      }
                      // mention education
                      else if (i == 17){
                        return myColour(+d.education)
                      }
                      // mention wealth
                      else if (i == 18){
                        return myColour(+d.wealth)
                      }
                      // mention car
                      else if (i == 19){
                        return myColour(+d.car)
                      }
                      // mention money
                      else if (i == 20){
                        return myColour(+d.money)
                      }
                      // mention weapon
                      else if (i == 21){
                        return myColour(+d.weapon)
                      }
                      // mention social-media 
                      else if (i == 22){
                        return myColour(+d.socialMedia)
                      }
                      // mention work
                      else if (i == 23){
                        return myColour(+d.work)
                      }
                      // mention crime
                      else if (i == 24){
                        return myColour(+d.crime)
                      }
                      // mention substances
                      else if (i == 25){
                        return myColour(+d.substanceUse)
                      }
                    })
                  }
                  // Making the tooltip available after clicking the buttons
                  tooltip()
            })

            document.getElementById('btnKM')
              .addEventListener('click', function(e){
                e.preventDefault();
              canvas3.selectAll("rect").remove()
              for(let i=0 ; i< 25 ; i++){
                canvas3.selectAll()
                  .data(data.filter(function(d){
                    return d.speaker == "killerMike" }))
                  .enter()
                  .append("rect")
                    .attr("x", 100 + (i * 32))
                    .attr("y", d => d.trackNumber * (32))
                    .attr("width", 30)
                    .attr("height", 30)
                    //.transition()
                    //.ease(d3.easeBounce)
                    //.duration(5000)
                    .style("fill", d => {
                      // mention Killer Mike
                      if(i == 0){
                        return myColour(+d.killerMike)
                      }
                      // mention El-P
                      else if (i == 1){
                        return myColour(+d.elP)
                      }
                      // mention Family
                      else if (i == 2){
                        return myColour(+d.family)
                      }
                      // mention boasting
                      else if (i == 3){
                        return myColour(+d.boasting)
                      }
                      // mention disillusion
                      else if (i == 4){
                        return myColour(+d.disillusion)
                      }
                      // mention threatening
                      else if (i == 5){
                        return myColour(+d.threatening)
                      }
                      // mention anguish
                      else if (i == 6){
                        return myColour(+d.anguish)
                      }
                      // mention existentialism
                      else if (i == 7){
                        return myColour(+d.existentialism)
                      }
                      // mention anti-capitalism
                      else if (i == 8){
                        return myColour(+d.antiCapitalism)
                      }
                      // mention anti-police
                      else if (i == 9){
                        return myColour(+d.antiPolice)
                      }
                      // mention authority
                      else if (i == 10){
                        return myColour(+d.authority)
                      }
                      // mention slavery
                      else if (i == 11){
                        return myColour(+d.slavery)
                      }
                      // mention racism
                      else if (i == 12){
                        return myColour(+d.racism)
                      }
                      // mention elections
                      else if (i == 13){
                        return myColour(+d.elections)
                      }
                      // mention revolution
                      else if (i == 14){
                        return myColour(+d.revolution)
                      }
                      // mention anti-religion
                      else if (i == 15){
                        return myColour(+d.antiReligion)
                      }
                      // mention poverty
                      else if (i == 16){
                        return myColour(+d.poverty)
                      }
                      // mention education
                      else if (i == 17){
                        return myColour(+d.education)
                      }
                      // mention wealth
                      else if (i == 18){
                        return myColour(+d.wealth)
                      }
                      // mention car
                      else if (i == 19){
                        return myColour(+d.car)
                      }
                      // mention money
                      else if (i == 20){
                        return myColour(+d.money)
                      }
                      // mention weapon
                      else if (i == 21){
                        return myColour(+d.weapon)
                      }
                      // mention social-media 
                      else if (i == 22){
                        return myColour(+d.socialMedia)
                      }
                      // mention work
                      else if (i == 23){
                        return myColour(+d.work)
                      }
                      // mention crime
                      else if (i == 24){
                        return myColour(+d.crime)
                      }
                      // mention substances
                      else if (i == 25){
                        return myColour(+d.substanceUse)
                      }
                    })
                  }
                  // Making the tooltip available after clicking the buttons
                  tooltip()
            })

            // Adding the mouseover event to each rectangle to display the tooltip and display the value of each bar
            // In a function so that it may be used repeatedly after clicking the buttons
            function tooltip(){
              canvas3.selectAll("rect")
                .on("mouseover", function(event, d) {
                  // To retrieve the RGBs of each cell in order to determine their value
                  //console.log(d3.select(event.target).attr('style'))
                  console.log(event.target)
                  let value
                  let table = []
                  for (let i = 0; i < 25; i++){
                    table.push(`fill: ${myColour(i)};`)
                  }
                  for (let i = 0; i < table.length; i++){
                    if (d3.select(event.target).attr('style') == table[i]){
                      value = i
                    }}
                  console.log(d3.select(event.target).attr('style'))
                  console.log(d3.select(event.target).attr('x'))
                  let table2 = [['Killer Mike', 100], ['El-P', 132], ['family', 164], ['boasting', 196], ['disillusion', 228], ['threatening', 260], ['anguish', 292], ['existentialism', 324], ['anti Capitalism', 356], ['anti police', 388], ['authority', 420], ['slavery', 452], ['racism', 484], ['elections', 516], ['revolution', 548], ['anti religion', 580], ['poverty', 612], ['education', 644], ['wealth', 676], ['car', 708], ['money', 714], ['weapons', 772], ['social media', 804], ['work', 836], ['crime', 868]]
                  let topic 
                  for (let i = 0; i < table2.length; i++){
                    if (d3.select(event.target).attr('x') == table2[i][1]){
                        topic = table2[i][0]
                    }
                  }
                  let speaker 
                  if (d.speaker == 'killerMike'){
                    speaker = 'Killer Mike'
                  } else if (d.speaker == 'el-p'){
                    speaker = 'El-P'
                  }
                  myDiv.transition()
                      .duration(200)
                      .style("opacity", .9)
                    myDiv.html(`${speaker} has mentioned ${topic} <br/> ${value} time(s) in this song`) 
                      .style("left", (event.pageX) + "px")
                      .style("top", (event.pageY - 28) + "px")
                      //console.log(d.value)
                              })
                .on("mouseout", function(d) {
                myDiv.transition()
                      .duration(500)
                      .style("opacity", 0)
                  });
              }
    })
</script>
</body>
</html>