<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grouped bar chart 2</title>

    <style>
        svg {
            background-color: whitesmoke;
            margin: 1px solid;
        }

        button {
            border-radius:10px;
            background-color:#e81ce8;
            color: white;
        }
    </style>    
</head>
<body>

    <button id= "Elbutton">El-p</button>
    <button id= "KMbutton">Killer Mike</button>

    <div id="#my_dataviz"></div>

<!-- Load d3.js -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<script>

    // window size and margin settings
    const width = window.innerWidth;
    const height = window.innerHeight;

    const margin = {top: 30, right: 30, bottom: 70, left: 60},
        w = 460 - margin.left - margin.right,
        h = 400 - margin.top - margin.bottom;

    // Link csv file to document
    d3.csv('RTJ4.csv', function(d) {
                return {
                    // speaker
                    speaker : d.speaker,
                    
                    //Subcategories
                    killerMike : +d.mentionKillerMike,
                    elP : +d.mentionElP,
                    family : +d.mentionFamily,
                    other : +d.mentionOsamaBL + +d.mentionMohammedAli + +d.mentionKurtVonnegut + +d.mentionAynRand + +d.mentionDonaldTrump + +d.mentionToussainLouverture + +d.mentionNapoleonBonaparte + +d.mentionMalcolmX + +d.mentionMLK + +d.mentionJimmySavile + +d.mentionNoamChomsky + +d.mentionCharlesBukowski + +d.mentionDickGregory,

                    boasting : +d.mentionBoasting,
                    disillusion : +d.mentionDisillusion,
                    threatening : +d.mentionThreatening,
                    anguish : +d.mentionAnguish,
                    existentialism : +d.mentionExistentialism,

                    poverty : +d.mentionPoverty,
                    education : +d.mentionEducation,
                    wealth : +d.mentionWealth,

                    work : +d.mentionWork,
                    crime : +d.mentionCrime,

                    antiCapitalism : +d.mentionAntiCapitalism,
                    antiPolice : +d.mentionAntiPolice, 
                    authority : +d.mentionAuthority,
                    slavery : +d.mentionSlavery,
                    racism : +d.mentionRacism,
                    elections : +d.mentionElections,
                    revolution : +d.mentionRevolution,
                    antiReligion : +d.mentionAntiReligion,

                    money : +d.mentionMoney,
                    car : +d.mentionCar, 
                    weapon : +d.mentionWeapon,
                    socialMedia : +d.mentionSocialMedia,

                    // Categories
                    person : +d.mentionKillerMike + +d.mentionElP + +d.mentionFamily + +d.mentionOsamaBL + +d.mentionMohammedAli + +d.mentionKurtVonnegut + +d.mentionAynRand + +d.mentionDonaldTrump + +d.mentionToussainLouverture + +d.mentionNapoleonBonaparte + +d.mentionMalcolmX + +d.mentionMLK + +d.mentionJimmySavile + +d.mentionNoamChomsky + +d.mentionCharlesBukowski + +d.mentionDickGregory,
                    feeling : +d.mentionBoasting + +d.mentionDisillusion + +d.mentionThreatening + +d.mentionAnguish + +d.mentionExistentialism,
                    place : +d.mentonBrooklyn + +d.mentionNewYork + +d.mentionMiami + +d.mentionAtlanta + +d.mentionGuantanamo,
                    state : +d.mentionPoverty + +d.mentionEducation + +d.mentionWealth,
                    politics: +d.mentionAntiCapitalism + +d.mentionAntiPolice + +d.mentionAuthority + +d.mentionSlavery + +d.mentionRacism + +d.mentionElections + +d.mentionRevolution + +d.mentionAntiReligion,
                    object : +d.mentionCar + +d.mentionMoney + +d.mentionWeapon + +d.mentionSocialMedia,
                    action : +d.mentionWork + +d.mentionCrime,
                    substanceUse : +d.mentionDrugs + +d.mentionAlcohol + +d.mentionTobacco,
                    
                    trackNumber : +d.trackNumber,
                }
            }).then(data => {
                //Check
                console.log("My complete data: " , data)
                console.log("Checking anti-police: ", data[1].politics) // output: 8. On the csv the first instance of anti-police (data[1].politics = 8)
                console.log("Checking anguish: ", data[7].anguish) // output: 3. Checks out with csv

                // Appending the svg to the body of the page
                let svg = d3.select("#my_dataviz")
                .append('svg')
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append('g')
                .attr("transform",`translate(${margin.left},${margin.top})`)

                // List of subgroups aka headers of the csv file - in this case the ones specified above
                // There are 50 columns in total on the csv file, but we want to ignore the first 4, as they are not subgroups for the purpose of this graph, hence -46
                // let subgroups = data.columns.slice(-46)
                let subgroups = data.columns.slice(47)
                

                // List of groups, aka the main groups to which the subgroups belong to - in this case the ones specified above
                let groups = ["person", "feeling", "place", "state", "politics", "object", "action", "substanceUse"]

                // Adding an X axis and adding it to the svg
                let xAxis = d3.scaleBand()
                    .domain(groups)
                    .range([0,width])
                    .padding([0.2])
                svg.append('g')
                .attr("transform", `translate(0, ${height})`)
                .call(d3.axisBottom(xAxis).tickSize(0))

                // Adding a Y axis and adding it to the svg
                let yAxis = d3.scaleLinear()
                    .domain([0, 160])
                    .range([ height, 0 ]);
                svg.append("g")
                    .call(d3.axisLeft(yAxis))

                // Another scale for subgroup posistion... idk if this is of any use
                let xSubgroup = d3.scaleBand()
                    .domain(subgroups)
                    .range([0, xAxis.bandwidth()])
                    .padding([0.05])

                // Color palette = one color per subgroup aka 46
                const color = d3.scaleOrdinal()
                    .domain(subgroups)
                    .range(['#e41a1c','#377eb8','#4daf4a'])

                // Creating the bars for the chart
                svg.append("g")
                    .selectAll("g")
                    // Enter in data = loop group per group
                    .data(data)
                    .join("g")
                    .attr("transform", d => `translate(${xAxis(d.group)}, 0)`)
                    .selectAll("rect")
                    .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
                    .join("rect")
                    .attr("x", d => xSubgroup(d.key))
                    .attr("y", d => yAxis(d.value))
                    .attr("width", xSubgroup.bandwidth())
                    .attr("height", d => height - y(d.value))
                    .attr("fill", d => color(d.key));




       
                
            })
        



</script>
</body>
</html>