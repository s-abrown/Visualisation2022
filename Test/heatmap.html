<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTJ4</title>

    <button id="btnElp">El-p</button>
    <button id="btnKM">Killer Mike</button>


    <style>
        svg {
            background-color: whitesmoke;
            margin: 1px solid;
            width: 100%;
            display: block;
            margin: auto;
        }

        canvas1 {
          width: 50%;
          display: block;
          margin: auto; 
        }

        div.tooltip {
            position: absolute;
            text-align: center;
            width: 70px;
            height: 65px;
            padding: 5px;
            font: 12px sans-serif;
            background: #f2b8ec;
            border: solid 2px;
            border-radius: 8px;
            pointer-events: none;
            display: inline-block;
        }

        button {
          background-color: grey;
          color: white;
          border-radius:10px;
          padding:15px;
          min-height:30px; 
          min-width: 120px;
        }

        button:hover {
          transition: 0.7s;
          background-color: hotpink;
        }

        button: active {
          background-color: hotpink;
        }

    </style>
</head>
<body>

    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

    <script>
      
        const margin = {top: 20, right: 10, bottom: 20, left: 10};
        const width = window.innerWidth - margin.left - margin.right,
              height = window.innerHeight - margin.top - margin.bottom;

        // LINKING THE CSV FILE TO THE DOCUMENT
        d3.csv('RTJ4.csv', function(d) {
            return {
                speaker : d.speaker,
                boasting : +d.mentionBoasting,
                killerMike : +d.mentionKillerMike,
                elP : +d.mentionElP,
                family : +d.mentionFamily,
                disillusion : +d.mentionDisillusion,
                threatening : +d.mentionThreatening,
                anguish : +d.mentionAnguish,
                existentialism : +d.mentionExistentialism,
                poverty : +d.mentionPoverty,
                education : +d.mentionEducation,
                wealth : +d.mentionWealth,
                work : +d.mentionWork,
                crime : +d.mentionCrime,
                elections : +d.mentionElections,
                slavery : +d.mentionSlavery,
                racism : +d.mentionRacism,
                revolution : +d.mentionRevolution,
                antiReligion : +d.mentionAntiReligion,
                authority : +d.mentionAuthority,
                antiCapitalism : +d.mentionAntiCapitalism,
                antiPolice : +d.mentionAntiPolice,
                money : +d.mentionMoney,
                car : +d.mentionCar, 
                weapon : +d.mentionWeapon,
                socialMedia : +d.mentionSocialMedia,
                person : +d.mentionKillerMike + +d.mentionElP + +d.mentionFamily + +d.mentionOsamaBL + +d.mentionMohammedAli + +d.mentionKurtVonnegut + +d.mentionAynRand + +d.mentionDonaldTrump + +d.mentionToussainLouverture + +d.mentionNapoleonBonaparte + +d.mentionMalcolmX + +d.mentionMLK + +d.mentionJimmySavile + +d.mentionNoamChomsky + +d.mentionCharlesBukowski + +d.mentionDickGregory,
                feeling : +d.mentionBoasting + +d.mentionDisillusion + +d.mentionThreatening + +d.mentionAnguish + +d.mentionExistentialism,
                place : +d.mentonBrooklyn + +d.mentionNewYork + +d.mentionMiami + +d.mentionAtlanta + +d.mentionGuantanamo,
                state : +d.mentionPoverty + +d.mentionEducation + +d.mentionWealth,
                object : +d.mentionCar + +d.mentionMoney + +d.mentionWeapon + +d.mentionSocialMedia,
                action : +d.mentionWork + +d.mentionCrime,
                substanceUse : +d.mentionDrugs + +d.mentionAlcohol + +d.mentionTobacco,
                trackNumber : +d.trackNumber,
            }
            // Possible place to add categories together to do an overall heatmap (for both speakers)?
        }).then(data => {
          let canvas1 = d3.select('body')
                .append('svg')
                //.attr('width', width - 40)
                .attr("width", width + margin.left + margin.right)
                //.attr('height', height - 40)
                .attr("height", height + margin.top + margin.bottom)
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

          // LABELS FOR THE X AND Y AXES
          let myGroups = ["1. Yankee and the Brave (Ep. 4)", "2. Ooh La La", "3. Out of Sight", "4. Holy Calamafuck", "5. Goonies vs. E.T.", "6. Walking in the Snow", "7. Ju$t", "8. Never Look Back", "9. The Ground Below", "10. Pulling the Pin", "11. A Few Words for the Firing Squad (Radiation)"]
          let myVars = ["Killer Mike", "El-P", "family", "boasting", "disillusion", "threatening", "anguish", "existentialism", "anti-capitalism", "anti-police", "authority", "slavery", "racism", "elections", "revolution", "anti-religion", "poverty", "education", "wealth", "car", "money", "weapon", "social-media ", "work", "crime", "substances"]

            // X AXIS AND SCALE
            let xScale = d3.scaleLinear()
               .domain([1, 25])
               .range([115, 884])
            
            let xAxisGenerator = d3.axisBottom(xScale);
            xAxisGenerator.ticks(25)
            xAxisGenerator.tickFormat((d,i) => myVars[i]);

            let xAxis = canvas1.append("g")
            .call(xAxisGenerator)
            .attr("transform", 'translate(0, 390)')
            .selectAll("text")
              .attr("transform", "translate(-10,2)rotate(-45)")
              .style("text-anchor", "end")
              .style("font-size", 15)
              .style("fill", "#6f00de")

            // Y AXIS AND SCALE
            let yScale = d3.scaleLinear()
               .domain([1, 11])
               .range([50, 370])
            
            let yAxisGenerator = d3.axisLeft(yScale);
            yAxisGenerator.ticks(11)
            yAxisGenerator.tickFormat((d,i) => myGroups[i]);

            let yAxis = canvas1.append("g")
            .call(yAxisGenerator)
            .attr("transform", 'translate(90, 0)')
            .selectAll("text")
              .style("font-size", 15)
              .style("fill", "#6f00de")

          // COLOUR SCALE FOR THE SQUARES
          let myColour = d3.scaleLinear()
            .range(["#ffdef3", "#6f00de"])
            .domain([0, 24])

          // Making a tooltip (refer to the html for more info on the styling)
          let div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);
        
          // ADDING THE SQUARES
          for(let i=0 ; i< 25 ; i++){
            canvas1.selectAll()
              .data(data.filter(function(d){
                return d.speaker == "el-p" }))
              .enter()
              .append("rect")
                .attr("x", 100 + (i * 32))
                .attr("y", d => d.trackNumber * (32))
                .attr("width", 30)
                .attr("height", 30)
                .style("fill", d => {
                  // mention Killer Mike
                  if(i == 0){
                     return myColour(+d.killerMike)
                  }
                  // mention El-P
                  else if (i == 1){
                    return myColour(+d.elP)
                  }
                  // mention Family
                  else if (i == 2){
                    return myColour(+d.family)
                  }
                  // mention boasting
                  else if (i == 3){
                    return myColour(+d.boasting)
                  }
                  // mention disillusion
                  else if (i == 4){
                    return myColour(+d.disillusion)
                  }
                  // mention threatening
                  else if (i == 5){
                    return myColour(+d.threatening)
                  }
                  // mention anguish
                  else if (i == 6){
                    return myColour(+d.anguish)
                  }
                  // mention existentialism
                  else if (i == 7){
                    return myColour(+d.existentialism)
                  }
                  // mention anti-capitalism
                  else if (i == 8){
                    return myColour(+d.antiCapitalism)
                  }
                  // mention anti-police
                  else if (i == 9){
                    return myColour(+d.antiPolice)
                  }
                  // mention authority
                  else if (i == 10){
                    return myColour(+d.authority)
                  }
                  // mention slavery
                  else if (i == 11){
                    return myColour(+d.slavery)
                  }
                  // mention racism
                  else if (i == 12){
                    return myColour(+d.racism)
                  }
                  // mention elections
                  else if (i == 13){
                    return myColour(+d.elections)
                  }
                  // mention revolution
                  else if (i == 14){
                    return myColour(+d.revolution)
                  }
                  // mention anti-religion
                  else if (i == 15){
                    return myColour(+d.antiReligion)
                  }
                  // mention poverty
                  else if (i == 16){
                    return myColour(+d.poverty)
                  }
                  // mention education
                  else if (i == 17){
                    return myColour(+d.education)
                  }
                  // mention wealth
                  else if (i == 18){
                    return myColour(+d.wealth)
                  }
                  // mention car
                  else if (i == 19){
                    return myColour(+d.car)
                  }
                  // mention money
                  else if (i == 20){
                    return myColour(+d.money)
                  }
                  // mention weapon
                  else if (i == 21){
                    return myColour(+d.weapon)
                  }
                  // mention social-media 
                  else if (i == 22){
                    return myColour(+d.socialMedia)
                  }
                  // mention work
                  else if (i == 23){
                    return myColour(+d.work)
                  }
                  // mention crime
                  else if (i == 24){
                    return myColour(+d.crime)
                  }
                  // mention substances
                  else if (i == 25){
                    return myColour(+d.substanceUse)
                  }
                })
                // Making the tooltip available after clicking the buttons
                tooltip()
              }

            document.getElementById('btnElp')
              .addEventListener('click', function(e){
              e.preventDefault();
              canvas1.selectAll("rect").remove()
              for(let i=0 ; i< 25 ; i++){
                canvas1.selectAll()
                  .data(data.filter(function(d){
                    return d.speaker == "el-p" }))
                  .enter()
                  .append("rect")
                    .attr("x", 100 + (i * 32))
                    .attr("y", d => d.trackNumber * (32))
                    .attr("width", 30)
                    .attr("height", 30)
                    .style("fill", d => {
                      // mention Killer Mike
                      if(i == 0){
                        return myColour(+d.killerMike)
                      }
                      // mention El-P
                      else if (i == 1){
                        return myColour(+d.elP)
                      }
                      // mention Family
                      else if (i == 2){
                        return myColour(+d.family)
                      }
                      // mention boasting
                      else if (i == 3){
                        return myColour(+d.boasting)
                      }
                      // mention disillusion
                      else if (i == 4){
                        return myColour(+d.disillusion)
                      }
                      // mention threatening
                      else if (i == 5){
                        return myColour(+d.threatening)
                      }
                      // mention anguish
                      else if (i == 6){
                        return myColour(+d.anguish)
                      }
                      // mention existentialism
                      else if (i == 7){
                        return myColour(+d.existentialism)
                      }
                      // mention anti-capitalism
                      else if (i == 8){
                        return myColour(+d.antiCapitalism)
                      }
                      // mention anti-police
                      else if (i == 9){
                        return myColour(+d.antiPolice)
                      }
                      // mention authority
                      else if (i == 10){
                        return myColour(+d.authority)
                      }
                      // mention slavery
                      else if (i == 11){
                        return myColour(+d.slavery)
                      }
                      // mention racism
                      else if (i == 12){
                        return myColour(+d.racism)
                      }
                      // mention elections
                      else if (i == 13){
                        return myColour(+d.elections)
                      }
                      // mention revolution
                      else if (i == 14){
                        return myColour(+d.revolution)
                      }
                      // mention anti-religion
                      else if (i == 15){
                        return myColour(+d.antiReligion)
                      }
                      // mention poverty
                      else if (i == 16){
                        return myColour(+d.poverty)
                      }
                      // mention education
                      else if (i == 17){
                        return myColour(+d.education)
                      }
                      // mention wealth
                      else if (i == 18){
                        return myColour(+d.wealth)
                      }
                      // mention car
                      else if (i == 19){
                        return myColour(+d.car)
                      }
                      // mention money
                      else if (i == 20){
                        return myColour(+d.money)
                      }
                      // mention weapon
                      else if (i == 21){
                        return myColour(+d.weapon)
                      }
                      // mention social-media 
                      else if (i == 22){
                        return myColour(+d.socialMedia)
                      }
                      // mention work
                      else if (i == 23){
                        return myColour(+d.work)
                      }
                      // mention crime
                      else if (i == 24){
                        return myColour(+d.crime)
                      }
                      // mention substances
                      else if (i == 25){
                        return myColour(+d.substanceUse)
                      }
                    })
                  }
                  // Making the tooltip available after clicking the buttons
                  tooltip()
            })

            document.getElementById('btnKM')
              .addEventListener('click', function(e){
                e.preventDefault();
              canvas1.selectAll("rect").remove()
              for(let i=0 ; i< 25 ; i++){
                canvas1.selectAll()
                  .data(data.filter(function(d){
                    return d.speaker == "killerMike" }))
                  .enter()
                  .append("rect")
                    .attr("x", 100 + (i * 32))
                    .attr("y", d => d.trackNumber * (32))
                    .attr("width", 30)
                    .attr("height", 30)
                    //.transition()
                    //.ease(d3.easeBounce)
                    //.duration(5000)
                    .style("fill", d => {
                      // mention Killer Mike
                      if(i == 0){
                        return myColour(+d.killerMike)
                      }
                      // mention El-P
                      else if (i == 1){
                        return myColour(+d.elP)
                      }
                      // mention Family
                      else if (i == 2){
                        return myColour(+d.family)
                      }
                      // mention boasting
                      else if (i == 3){
                        return myColour(+d.boasting)
                      }
                      // mention disillusion
                      else if (i == 4){
                        return myColour(+d.disillusion)
                      }
                      // mention threatening
                      else if (i == 5){
                        return myColour(+d.threatening)
                      }
                      // mention anguish
                      else if (i == 6){
                        return myColour(+d.anguish)
                      }
                      // mention existentialism
                      else if (i == 7){
                        return myColour(+d.existentialism)
                      }
                      // mention anti-capitalism
                      else if (i == 8){
                        return myColour(+d.antiCapitalism)
                      }
                      // mention anti-police
                      else if (i == 9){
                        return myColour(+d.antiPolice)
                      }
                      // mention authority
                      else if (i == 10){
                        return myColour(+d.authority)
                      }
                      // mention slavery
                      else if (i == 11){
                        return myColour(+d.slavery)
                      }
                      // mention racism
                      else if (i == 12){
                        return myColour(+d.racism)
                      }
                      // mention elections
                      else if (i == 13){
                        return myColour(+d.elections)
                      }
                      // mention revolution
                      else if (i == 14){
                        return myColour(+d.revolution)
                      }
                      // mention anti-religion
                      else if (i == 15){
                        return myColour(+d.antiReligion)
                      }
                      // mention poverty
                      else if (i == 16){
                        return myColour(+d.poverty)
                      }
                      // mention education
                      else if (i == 17){
                        return myColour(+d.education)
                      }
                      // mention wealth
                      else if (i == 18){
                        return myColour(+d.wealth)
                      }
                      // mention car
                      else if (i == 19){
                        return myColour(+d.car)
                      }
                      // mention money
                      else if (i == 20){
                        return myColour(+d.money)
                      }
                      // mention weapon
                      else if (i == 21){
                        return myColour(+d.weapon)
                      }
                      // mention social-media 
                      else if (i == 22){
                        return myColour(+d.socialMedia)
                      }
                      // mention work
                      else if (i == 23){
                        return myColour(+d.work)
                      }
                      // mention crime
                      else if (i == 24){
                        return myColour(+d.crime)
                      }
                      // mention substances
                      else if (i == 25){
                        return myColour(+d.substanceUse)
                      }
                    })
                  }
                  // Making the tooltip available after clicking the buttons
                  tooltip()
            })

            // Adding the mouseover event to each rectangle to display the tooltip and display the value of each bar
            // In a function so that it may be used repeatedly after clicking the buttons
            function tooltip(){
              canvas1.selectAll("rect")
                .on("mouseover", function(event, d) {
                  // To retrieve the RGBs of each cell in order to determine their value
                  //console.log(d3.select(event.target).attr('style'))
                  console.log(event.target)
                  let value
                  let table = []
                  for (let i = 0; i < 25; i++){
                    table.push(`fill: ${myColour(i)};`)
                  }
                  for (let i = 0; i < table.length; i++){
                    if (d3.select(event.target).attr('style') == table[i]){
                      value = i
                    }}
                  console.log(d3.select(event.target).attr('style'))
                  console.log(d3.select(event.target).attr('x'))
                  let table2 = [['Killer Mike', 100], ['El-P', 132], ['family', 164], ['boasting', 196], ['disillusion', 228], ['threatening', 260], ['anguish', 292], ['existentialism', 324], ['anti Capitalism', 356], ['anti police', 388], ['authority', 420], ['slavery', 452], ['racism', 484], ['elections', 516], ['revolution', 548], ['anti religion', 580], ['poverty', 612], ['education', 644], ['wealth', 676], ['car', 708], ['money', 714], ['weapons', 772], ['social media', 804], ['work', 836], ['crime', 868]]
                  let topic 
                  for (let i = 0; i < table2.length; i++){
                    if (d3.select(event.target).attr('x') == table2[i][1]){
                        topic = table2[i][0]
                    }
                  }
                  let speaker 
                  if (d.speaker == 'killerMike'){
                    speaker = 'Killer Mike'
                  } else if (d.speaker == 'el-p'){
                    speaker = 'El-P'
                  }
                  div.transition()
                      .duration(200)
                      .style("opacity", .9)
                  div.html(`${speaker} has mentioned ${topic} <br/> ${value} time(s) in this song`) 
                      .style("left", (event.pageX) + "px")
                      .style("top", (event.pageY - 28) + "px")
                      //console.log(d.value)
                              })
                .on("mouseout", function(d) {
                  div.transition()
                      .duration(500)
                      .style("opacity", 0)
                  });
              }
})


    </script>
    
</body>
</html>


</script>