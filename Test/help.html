<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTJ4</title>

    <style>
        svg {
            background-color: whitesmoke;
            margin: 1px solid;
        }
    </style>
</head>
<body>

    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

    <script>
        // window size
        const width = window.innerWidth;
        const height = window.innerHeight;

        const margin = {top: 30, right: 30, bottom: 70, left: 60},
            w = 460 - margin.left - margin.right,
            h = 400 - margin.top - margin.bottom;

        // Link csv file to document
        d3.csv('RTJ4.csv', function(d) {
            return {
                speaker : d.speaker,
                boasting : +d.mentionBoasting,
                person : +d.mentionKillerMike + +d.mentionElP + +d.mentionFamily + +d.mentionOsamaBL + +d.mentionMohammedAli + +d.mentionKurtVonnegut + +d.mentionAynRand + +d.mentionDonaldTrump + +d.mentionToussainLouverture + +d.mentionNapoleonBonaparte + +d.mentionMalcolmX + +d.mentionMLK + +d.mentionJimmySavile + +d.mentionNoamChomsky + +d.mentionCharlesBukowski + +d.mentionDickGregory,
                feeling : +d.mentionBoasting + +d.mentionDisillusion + +d.mentionThreatening + +d.mentionAnguish + +d.mentionExistentialism,
                place : +d.mentonBrooklyn + +d.mentionNewYork + +d.mentionMiami + +d.mentionAtlanta + +d.mentionGuantanamo,
                state : +d.mentionPoverty + +d.mentionEducation + +d.mentionWealth,
                object : +d.mentionCar + +d.mentionMoney + +d.mentionWeapon + +d.mentionSocialMedia,
                action : +d.mentionWork + +d.mentionCrime,
                substanceUse : +d.mentionDrugs + +d.mentionAlcohol + +d.mentionTobacco,
                trackNumber : +d.trackNumber, 
            }
        }).then(data => {
            // Check
            console.log(" Complete data set organised by CATEGORY (≠ subcategory): ", data)
            console.log("TRACK NUMBER : ", data[0].trackNumber)

            
          // max boasting?
            let maxBoasting = d3.max(data, d => d.boasting);
            console.log("Max boasting : " , maxBoasting) // 24
            // min boasting?
            let minBoasting = d3.min(data, d => d.boasting);
            console.log("Min boasting : ", minBoasting) // 0 

            // Drawing space N°1 for boasting (El-p, KM, ZDLR)
            let canvas1 = d3.select('body')
                .append('svg')
                .attr('width', width - 40)
                .attr('height', height - 40)
                // .on('click', functionClick);

            // Données continues???
            const donneesContinues = d3.range(1, 13, 1)
            console.log("données continues : ", donneesContinues) 
             
                
            
             // X Scale
            const xScale = d3.scaleLinear()
            // domain of data
                .domain([1, 11])
            // range
                .range([width/12, width*11/12 ])
            // X axis
            const xAxis = d3.axisBottom(xScale).ticks(12)
            // append axis
            canvas1.append('g')
                //.attr('tranform', 'translate(0, 100)')
                .attr("transform", "translate(0," + 30 + ")")

                .call(xAxis)
            // Y Scale
            const yScale = d3.scaleLinear()
                .domain(minBoasting, maxBoasting)
                .range([height, 0])
            // avoid going over
            const dontGoOver = d3.scaleLinear 

            // Adding Légende
            // circles
            let speakers = ['el-p', 'killerMike', 'ZackDeLaRocha', 'pharrellWilliams', 'noInstances']
            canvas1.append('g').selectAll('circle')
                .data(speakers)
                .enter()
                .append('circle')
                    .attr('cx', 50)
                    .attr('cy', (h, j) => 3 + (height * 0.75) + j * 25)
                    .attr('r', (h, j) => {
                        if(j == 4){return 2}
                        else{return 10}
                    })
                    .attr('fill', (h, j) => {
                        if(speakers[j] == 'el-p'){return 'green'}
                        else if(speakers[j] == 'killerMike'){return 'red'}
                        else if(speakers[j] == 'ZackDeLaRocha'){return 'blue'}
                        else if(speakers[j] == "pharrellWilliams"){return 'orange'}
                        else if(speakers[j] == 'noInstances'){return 'black'}
                    })

            // corresponding text
            canvas1.append('g').selectAll('text')
                .data(speakers)
                 .enter()
                .append('text')
                     .attr('x', 70)
                     .attr('y', (h, j) => 3 + (height * 0.75) + j * 25)
                    .text(h => h)
                    .attr('fill', (h, j) => {
                        if(speakers[j] == 'el-p'){return 'green'}
                        else if(speakers[j] == 'killerMike'){return 'red'}
                        else if(speakers[j] == 'ZackDeLaRocha'){return 'blue'}
                        else if(speakers[j] == "pharrellWilliams"){return 'orange'}
                        else if(speakers[j] == 'noInstances'){return 'black'}
                    })


            // boasting per speaker in each song
            canvas1.append('g').selectAll('circle')
            .data(data)
            .enter()
            .append('circle')
                //.attr('cx', (d, i) => 100 + (width-40)/22 * i)
                .attr('cx', d => d.trackNumber * (width/12 ))
                .attr('cy', d => {
                    console.log("SHOW D : ", d)
                    if(d.speaker == "el-p"){ return (50+0.5* width/12)}
                    else if(d.speaker == 'killerMike'){return (  50 + 1.5*width/12)}
                    else if(d.speaker == "ZackDeLaRocha"){return ( 50+ 2.5*width/12)}
                    else if(d.speaker == "pharrellWilliams"){return (50 + 3.5 * width / 12)}
                })
                .attr('r', d => {
                    if(d.boasting == 0) {return 2}
                    else {return 0.25*Math.sqrt(d.boasting/6 ) * ((width - 100) / 12)}
                })
                .attr('fill', d => {
                    if(d.boasting == 0) {return 'black'}
                    else if(d.speaker == "el-p"){return 'green'}
                    else if(d.speaker == 'killerMike'){return 'red'}
                    else if(d.speaker == "ZackDeLaRocha"){return 'blue'}
                    else if(d.speaker == "pharrellWilliams"){return 'yellow'}
                })
                .attr('opacity', 1)

                // Boasting per speaker (total/ across the whole album)
                /* let boastingPerSpeaker = d3.rollups(data, v=> d3.sum(v, d => d.boasting), d => d.speaker)
                console.log("BOASTING PER SPEAKER : " , boastingPerSpeaker) */



        })

    </script>
    
</body>
</html>