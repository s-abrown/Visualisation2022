<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIE Chart</title>
    <style>
        svg {
            background-color: whitesmoke;
            margin: 1px solid;
        }
        #feelings {
            border: solid 2px;
            background-color: hotpink;
            display: inline-block;
        }
    </style>

<body>

<div id="my_pie"></div>
<div id="resultElp"></div>
</br>
<div id="resultKM"></div>

<!-- Create a div where the graph will take place -->
<div class="pieOptions">
    <div> Choose parameters: </div>
    </br>
    <div id="feelings">Feelings</div>
    <div id="boasting">Boasting</div>
    <div id="substanceUse">Substance use</div>
    <div id="people">People</div>
    <div id="place">Place</div>
    <div id="state">State</div>
    <div id="object">Object</div>
    <div id="action">Action</div>
</div>

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>

<script>


d3.csv('RTJ4.csv', function (d) {
            return {
                speaker : d.speaker,
                boasting : +d.mentionBoasting,
                killerMike : +d.mentionKillerMike,
                elP : +d.mentionElP,
                family : +d.mentionFamily,
                disillusion : +d.mentionDisillusion,
                threatening : +d.mentionThreatening,
                anguish : +d.mentionAnguish,
                existentialism : +d.mentionExistentialism,
                poverty : +d.mentionPoverty,
                education : +d.mentionEducation,
                wealth : +d.mentionWealth,
                work : +d.mentionWork,
                crime : +d.mentionCrime,
                elections : +d.mentionElections,
                slavery : +d.mentionSlavery,
                racism : +d.mentionRacism,
                revolution : +d.mentionRevolution,
                antiReligion : +d.mentionAntiReligion,
                authority : +d.mentionAuthority,
                antiCapitalism : +d.mentionAntiCapitalism,
                antiPolice : +d.mentionAntiPolice,
                money : +d.mentionMoney,
                car : +d.mentionCar, 
                weapon : +d.mentionWeapon,
                socialMedia : +d.mentionSocialMedia,
                
                person : +d.mentionKillerMike + +d.mentionElP + +d.mentionFamily + +d.mentionOsamaBL + +d.mentionMohammedAli + +d.mentionKurtVonnegut + +d.mentionAynRand + +d.mentionDonaldTrump + +d.mentionToussainLouverture + +d.mentionNapoleonBonaparte + +d.mentionMalcolmX + +d.mentionMLK + +d.mentionJimmySavile + +d.mentionNoamChomsky + +d.mentionCharlesBukowski + +d.mentionDickGregory,
                feeling : +d.mentionBoasting + +d.mentionDisillusion + +d.mentionThreatening + +d.mentionAnguish + +d.mentionExistentialism,
                place : +d.mentonBrooklyn + +d.mentionNewYork + +d.mentionMiami + +d.mentionAtlanta + +d.mentionGuantanamo,
                state : +d.mentionPoverty + +d.mentionEducation + +d.mentionWealth,
                object : +d.mentionCar + +d.mentionMoney + +d.mentionWeapon + +d.mentionSocialMedia,
                action : +d.mentionWork + +d.mentionCrime,
                substanceUse : +d.mentionDrugs + +d.mentionAlcohol + +d.mentionTobacco,

                trackNumber : +d.trackNumber,
            }
        }).then(data => {

            // set the dimensions and margins of the graph
            const piewidth = 450,
                pieheight = 450,
                piemargin = 40;
            
            // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
            const radius = Math.min(piewidth, pieheight) / 2 - piemargin;
            
            // append the svg object to the div called 'my_dataviz'
            const svg = d3.select("#my_pie")
            .append("svg")
                .attr("width", piewidth)
                .attr("height", pieheight)
            .append("g")
                .attr("transform", `translate(${piewidth/2}, ${pieheight/2})`);
            
            
            let boastingAlbumEl = 0
            let Elmentionpp = 0
            let Elfeelings = 0
            let Elplaces = 0
            let Elsubstances = 0
            let Elstate = 0
            let Elobjs = 0
            let Elcrime = 0
            let Elwork = 0
            let boastingAlbumKM = 0
            let KMmentionpp = 0
            let KMfeelings = 0
            let KMplaces = 0
            let KMsubstances = 0
            let KMstate = 0
            let KMobjs = 0
            let KMcrime = 0
            let KMwork = 0
            let boastingAlbumPW = 0
            let boastingAlbumZDR = 0
            for (let i = 0; i < data.length; i++){
                if (data[i].speaker == 'el-p'){
                boastingAlbumEl += data[i].boasting
                Elmentionpp += data[i].person
                Elfeelings += data[i].feeling
                Elplaces += data[i].place
                Elsubstances += data[i].substanceUse
                Elstate += data[i].state
                Elobjs += data[i].object
                Elcrime += data[i].crime
                Elwork += data[i].work
                }
                if (data[i].speaker == 'killerMike'){
                boastingAlbumKM += data[i].boasting
                KMmentionpp += data[i].person
                KMfeelings += data[i].feeling
                KMplaces += data[i].place
                KMsubstances += data[i].substanceUse
                KMstate += data[i].state
                KMobjs += data[i].object
                KMcrime += data[i].crime
                KMwork += data[i].work
                }
            }

            let valueEl = boastingAlbumEl
            let valueKM = boastingAlbumKM

            let dataset = {El:valueEl, KM:valueKM}
            let topic = "boasting"

            document.getElementById('people')
                .addEventListener('click', function(e){
                    e.preventDefault();
                    valueEl = Elmentionpp
                    valueKM = KMmentionpp
                    dataset = {El:valueEl, KM:valueKM}
                    console.log(dataset)
                    topic = "people"
                    update(dataset)
                })

            document.getElementById('feelings')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elfeelings
                valueKM = KMfeelings
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "feelings"
                update(dataset)
            })

            document.getElementById('boasting')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = boastingAlbumEl
                valueKM = boastingAlbumKM
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "boasting"
                update(dataset)
            })

            document.getElementById('substanceUse')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elsubstances
                valueKM = KMsubstances
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "substance use"
                update(dataset)
            })

            document.getElementById('place')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elplaces
                valueKM = KMplaces
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "places"
                update(dataset)
            })

            document.getElementById('state')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elstate
                valueKM = KMstate
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "states of being"
                update(dataset)
            })

            document.getElementById('object')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elobjs
                valueKM = KMobjs
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "objects"
                update(dataset)
            })

            document.getElementById('action')
            .addEventListener('click', function(e){
                e.preventDefault();
                valueEl = Elcrime + Elwork
                valueKM = KMcrime + KMwork
                dataset = {El:valueEl, KM:valueKM}
                console.log(dataset)
                topic = "actions"
                update(dataset)
            })
            console.log(dataset.El)

            // A function that create / update the plot for a given variable:
            function update(data) {

            // Compute the position of each group on the pie:
            const pie = d3.pie()
            .value(function(d) {return d[1]; })
            .sort(function(a, b) { return d3.ascending(a.key, b.key);} ) // This make sure that group order remains the same in the pie chart
            const data_ready = pie(Object.entries(data))

            // map to data
            const u = svg.selectAll("path")
            .data(data_ready)

            // Building the pie chart: 
            u
            .join('path')
            // The transition does not always work proprely. We tried to look for solutions online but nothing worked for our project. We undesrtand it is a problem of d3 calculating the position of the arc while transitioning, and that using attrTween would help. As of right now we can't get it to work.
            .transition()
            .duration(1000)
            .attr('d', d3.arc()
                .innerRadius(0)
                .outerRadius(radius)
            )
            .attr('fill', function(d){
                if(d.data[0] == "El"){
                    return "hotpink"
                }
                else if (d.data[0] == "KM"){
                    return "purple"
                }
             })
            .attr("stroke", "white")
            .style("stroke-width", "2px")
            .style("opacity", 1)

            let ElDiv = document.getElementById("resultElp")
            ElDiv.innerHTML = `El-p has mentioned ${topic} ${dataset.El} time(s)`
            let KMDiv = document.getElementById("resultKM")
            KMDiv.innerHTML = `Killer Mike has mentioned ${topic} ${dataset.KM} time(s)`
        }


            // Initialize the plot with the first dataset
            update(dataset)
    })



</script>
</body>
</html>
